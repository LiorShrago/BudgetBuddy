{% extends "base.html" %}

{% block title %}Expense Visualizations - Budget Tracker{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i data-feather="bar-chart-2"></i>
        Expense Visualizations
    </h1>
    <div>
        <button type="button" class="btn btn-outline-secondary" id="customize-btn" data-bs-toggle="modal" data-bs-target="#customizeModal">
            <i data-feather="settings"></i>
            Customize
        </button>
        <button type="button" class="btn btn-primary" id="export-btn">
            <i data-feather="download"></i>
            Export
        </button>
    </div>
</div>

<!-- Chart Controls -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i data-feather="sliders"></i>
            Chart Controls
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-3">
                <label for="time-period" class="form-label">Time Period</label>
                <select class="form-select" id="time-period">
                    <option value="last_30">Last 30 Days</option>
                    <option value="last_90">Last 3 Months</option>
                    <option value="last_180">Last 6 Months</option>
                    <option value="last_365" selected>Last Year</option>
                    <option value="all">All Time</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            
            <div class="col-md-3">
                <label for="chart-type" class="form-label">Primary Chart Type</label>
                <select class="form-select" id="chart-type">
                    <option value="doughnut">Doughnut Chart</option>
                    <option value="pie">Pie Chart</option>
                    <option value="bar">Bar Chart</option>
                    <option value="polarArea">Polar Area</option>
                    <option value="radar">Radar Chart</option>
                </select>
            </div>
            
            <div class="col-md-3">
                <label for="account-filter" class="form-label">Account</label>
                <select class="form-select" id="account-filter">
                    <option value="">All Accounts</option>
                    {% for account in accounts %}
                    <option value="{{ account.id }}">{{ account.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="col-md-3 d-flex align-items-end">
                <button type="button" class="btn btn-info w-100" id="refresh-charts">
                    <i data-feather="refresh-cw"></i>
                    Update Charts
                </button>
            </div>
        </div>
        
        <div class="row mt-3" id="custom-date-range" style="display: none;">
            <div class="col-md-3">
                <label for="start-date" class="form-label">Start Date</label>
                <input type="date" class="form-control" id="start-date">
            </div>
            <div class="col-md-3">
                <label for="end-date" class="form-label">End Date</label>
                <input type="date" class="form-control" id="end-date">
            </div>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4" id="summary-cards">
    <div class="col-md-3">
        <div class="card text-center gradient-card-1">
            <div class="card-body">
                <h5 class="card-title text-white">Total Expenses</h5>
                <h2 class="text-white" id="total-expenses">$0.00</h2>
                <small class="text-white opacity-75" id="expense-period">Last 365 days</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center gradient-card-2">
            <div class="card-body">
                <h5 class="card-title text-white">Average Monthly</h5>
                <h2 class="text-white" id="avg-monthly">$0.00</h2>
                <small class="text-white opacity-75">Per month</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center gradient-card-3">
            <div class="card-body">
                <h5 class="card-title text-white">Top Category</h5>
                <h2 class="text-white" id="top-category">-</h2>
                <small class="text-white opacity-75" id="top-category-amount">$0.00</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center gradient-card-4">
            <div class="card-body">
                <h5 class="card-title text-white">Categories Used</h5>
                <h2 class="text-white" id="categories-count">0</h2>
                <small class="text-white opacity-75">Active categories</small>
            </div>
        </div>
    </div>
</div>

<!-- Category Breakdown Summary -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i data-feather="pie-chart"></i>
                    Spending Breakdown by Category
                </h5>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-secondary" onclick="toggleView('category-breakdown')">
                        <i data-feather="eye"></i>
                        Toggle View
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="animateChart('primary-chart')">
                        <i data-feather="play"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="downloadChart('primary-chart')">
                        <i data-feather="camera"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="chart-container">
                            <canvas id="primary-chart" width="400" height="400"></canvas>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="category-breakdown-list" id="category-breakdown-list">
                            <!-- Dynamic category breakdown will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Charts -->
<div class="row mb-4">
    
    <!-- Spending Trend Chart -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Spending Trend</h5>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-secondary" onclick="animateChart('trend-chart')">
                        <i data-feather="play"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="downloadChart('trend-chart')">
                        <i data-feather="camera"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="trend-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secondary Charts -->
<div class="row mb-4">
    <!-- Monthly Comparison -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Monthly Comparison</h5>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-secondary" onclick="animateChart('monthly-chart')">
                        <i data-feather="play"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="downloadChart('monthly-chart')">
                        <i data-feather="camera"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="monthly-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Account Distribution -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Account Distribution</h5>
                <div class="btn-group btn-group-sm" role="group">
                    <button type="button" class="btn btn-outline-secondary" onclick="animateChart('account-chart')">
                        <i data-feather="play"></i>
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="downloadChart('account-chart')">
                        <i data-feather="camera"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-container">
                    <canvas id="account-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fun Stats -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="smile"></i>
                    Fun Financial Facts
                </h5>
            </div>
            <div class="card-body">
                <div class="row" id="fun-stats">
                    <!-- Dynamic fun stats will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Customization Modal -->
<div class="modal fade" id="customizeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i data-feather="settings"></i>
                    Customize Charts
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="color-scheme" class="form-label">Color Scheme</label>
                        <select class="form-select" id="color-scheme">
                            <option value="default">Default Rainbow</option>
                            <option value="pastel">Pastel Dreams</option>
                            <option value="neon">Neon Vibes</option>
                            <option value="earth">Earth Tones</option>
                            <option value="ocean">Ocean Blues</option>
                            <option value="sunset">Sunset Glow</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <label for="animation-style" class="form-label">Animation Style</label>
                        <select class="form-select" id="animation-style">
                            <option value="easeOutQuart">Smooth (Default)</option>
                            <option value="easeOutBounce">Bouncy</option>
                            <option value="easeOutElastic">Elastic</option>
                            <option value="easeInOutBack">Dramatic</option>
                        </select>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="show-animations" checked>
                            <label class="form-check-label" for="show-animations">
                                Enable Animations
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="show-values" checked>
                            <label class="form-check-label" for="show-values">
                                Show Values on Charts
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="show-percentages" checked>
                            <label class="form-check-label" for="show-percentages">
                                Show Percentages
                            </label>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="dark-theme">
                            <label class="form-check-label" for="dark-theme">
                                Dark Chart Theme
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="apply-customization">Apply Changes</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.gradient-card-1 {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.gradient-card-2 {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.gradient-card-3 {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.gradient-card-4 {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.chart-container {
    position: relative;
    height: 400px;
    max-height: 400px;
}

.chart-container canvas {
    max-height: 100%;
}

@keyframes chartPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.chart-pulse {
    animation: chartPulse 0.6s ease-in-out;
}

.fun-stat-card {
    text-align: center;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
    color: white;
    transition: transform 0.3s ease;
}

.fun-stat-card:hover {
    transform: translateY(-5px);
}

.category-breakdown-list {
    max-height: 400px;
    overflow-y: auto;
}

.category-item {
    display: flex;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #eee;
}

.category-item:last-child {
    border-bottom: none;
}

.category-color {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin-right: 12px;
    flex-shrink: 0;
}

.category-info {
    flex: 1;
    min-width: 0;
}

.category-name {
    font-weight: 600;
    color: #212529;
    margin-bottom: 4px;
}

.category-amount {
    font-size: 0.9rem;
    color: #495057;
    margin-bottom: 6px;
}

.category-progress {
    width: 100%;
    height: 8px;
    background-color: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
}

.category-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    border-radius: 4px;
    transition: width 0.8s ease;
}

.category-percentage {
    font-size: 0.85rem;
    font-weight: 600;
    color: #212529;
    margin-left: 8px;
    flex-shrink: 0;
}

.breakdown-header {
    font-size: 1.1rem;
    font-weight: 600;
    color: #212529;
    margin-bottom: 20px;
    text-align: center;
    padding-bottom: 10px;
    border-bottom: 2px solid #f0f0f0;
}

.breakdown-total {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 20px;
}

.breakdown-total h6 {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.9;
}

.breakdown-total h4 {
    margin: 5px 0 0 0;
    font-size: 1.5rem;
    font-weight: bold;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/visualizations.js') }}"></script>
{% endblock %}