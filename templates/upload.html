{% extends "base.html" %}

{% block title %}Import CSV - BudgetBuddy{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i data-feather="upload"></i>
        Import CSV Transactions
    </h1>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Upload Transaction File</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="uploadForm">
                    <div class="mb-3">
                        <label class="form-label">Account Selection</label>
                        
                        <!-- Radio buttons for account selection -->
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="account_option" id="existing_account" value="existing" checked>
                            <label class="form-check-label" for="existing_account">
                                Use existing account
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="account_option" id="new_account" value="new">
                            <label class="form-check-label" for="new_account">
                                Create new account
                            </label>
                        </div>
                    </div>
                    
                    <!-- Existing account selection -->
                    <div class="mb-3" id="existing_account_section">
                        <label for="account_id" class="form-label">Select Account</label>
                        <select class="form-select" id="account_id" name="account_id">
                            <option value="">Choose an account...</option>
                            {% for account in accounts %}
                            <option value="{{ account.id }}">{{ account.name }} ({{ account.account_type|title }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- New account creation -->
                    <div class="mb-3" id="new_account_section" style="display: none;">
                        <input type="hidden" name="create_new_account" id="create_new_account" value="false">
                        
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0">
                                    <i data-feather="plus-circle"></i>
                                    Create New Account
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <label for="new_account_name" class="form-label">Account Name</label>
                                        <input type="text" class="form-control" id="new_account_name" name="new_account_name" placeholder="e.g., Chase Credit Card">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="new_account_type" class="form-label">Account Type</label>
                                        <select class="form-select" id="new_account_type" name="new_account_type">
                                            <option value="">Choose type...</option>
                                            <option value="checking">Checking</option>
                                            <option value="savings">Savings</option>
                                            <option value="credit_card">Credit Card</option>
                                            <option value="investment">Investment</option>
                                            <option value="loan">Loan</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-text mt-2">
                                    This account will be created and your transactions will be imported into it.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="csv_format" class="form-label">CSV Format</label>
                        <select class="form-select" id="csv_format" name="csv_format" required>
                            <option value="auto">Auto-detect format</option>
                            <option value="amex">American Express</option>
                            <option value="cibc">CIBC</option>
                            <option value="eq_bank">EQ Bank</option>
                            <option value="simplii">Simplii Financial</option>
                            <option value="td">TD Bank</option>
                        </select>
                        <div class="form-text">
                            Select your bank's CSV format for optimal parsing. Auto-detect will try to identify the format automatically.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="file" class="form-label">CSV File</label>
                        <input type="file" class="form-control" id="file" name="file" accept=".csv" required>
                        <div class="form-text">
                            Upload a CSV file with transaction data from your selected bank.
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="upload"></i>
                            Upload and Process
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i data-feather="help-circle"></i>
                    Supported Bank Formats
                </h5>
            </div>
            <div class="card-body">
                <h6>Supported Banks:</h6>
                <ul class="list-unstyled small">
                    <li><strong>American Express:</strong> Date, Description, Amount</li>
                    <li><strong>CIBC:</strong> Date, Description, Debit, Credit</li>
                    <li><strong>EQ Bank:</strong> Date, Description, Amount, Balance</li>
                    <li><strong>Simplii Financial:</strong> Date, Details, Funds Out, Funds In</li>
                    <li><strong>TD Bank:</strong> Date, Description, Debit</li>
                    <li><strong>Generic CSV:</strong> Any standard format</li>
                </ul>
                
                <h6 class="mt-3">Auto-Detection:</h6>
                <p class="small text-muted">
                    The system can automatically detect your bank's format based on the CSV structure. 
                    Manual selection ensures optimal parsing accuracy.
                </p>
                
                <h6 class="mt-3">Features:</h6>
                <ul class="list-unstyled small">
                    <li>✓ Bank-specific CSV parsing</li>
                    <li>✓ Automatic format detection</li>
                    <li>✓ Duplicate transaction prevention</li>
                    <li>✓ Smart categorization</li>
                    <li>✓ Merchant name extraction</li>
                </ul>
            </div>
        </div>
        
        {% if not accounts %}
        <div class="card mt-3">
            <div class="card-body text-center">
                <i data-feather="alert-circle" class="text-warning mb-3" style="width: 48px; height: 48px;"></i>
                <h6>No Accounts Found</h6>
                <p class="text-muted">You need to create an account before importing transactions.</p>
                <a href="{{ url_for('accounts') }}" class="btn btn-primary">
                    <i data-feather="plus"></i>
                    Add Account
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/upload.js') }}"></script>
{% endblock %}
